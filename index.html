<!doctype html>
<html lang="en">
  <head>
    <!-- These did not seem to help with avoiding stale pages
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    -->
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no, interactive-widget=resizes-content"
    />
    <meta name="theme-color" content="#ffffff" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="mobile-web-app-capable" content="yes" />

    <!-- Add these new meta tags for splash screen -->
    <link rel="apple-touch-icon" href="./media/liberdus_logo_512.png" />
    <meta name="apple-mobile-web-app-title" content="Liberdus" />

    <!-- Add splash screen images for different iPhone sizes -->
    <link
      rel="apple-touch-startup-image"
      href="splash_640x1136.png"
      media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)"
    />
    <link
      rel="apple-touch-startup-image"
      href="splash_750x1334.png"
      media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)"
    />
    <link
      rel="apple-touch-startup-image"
      href="splash_1170x2532.png"
      media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3)"
    />
    <link
      rel="apple-touch-startup-image"
      href="splash_1179x2556.png"
      media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3)"
    />
    <link
      rel="apple-touch-startup-image"
      href="splash_1290x2796.png"
      media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3)"
    />

    <title>Liberdus</title>
    <!--
      QRCode lib from
      https://github.com/davidshimjs/qrcodejs
      https://github.com/davidshimjs/qrcodejs/blob/master/qrcode.js
    -->
    <script src="./external/qr.js" defer></script>
    <script src="./network.js"></script>
    <link rel="stylesheet" href="./styles.css" />
    <!-- <link rel="manifest" href="./manifest.json" /> -->
  </head>
  <body>
    <script src="./app.js" type="module" defer></script>
    <div class="container">
      <header class="header" id="header">
        <div id="logo">
          <a href="https://liberdus.com" target="_blank" title="Visit Liberdus website" class="logo-link"
            ><img src="./media/liberdus_logo_50.png"
          /></a>
        </div>
        <div class="app-name">Liberdus</div>
        <div class="header-icons">
          <div class="offline-indicator" id="offlineIndicator">Offline</div>
          <div id="wsStatusIndicator" class="ws-status-indicator" style="display: none">WebSocket</div>
          <button class="icon-button" id="toggleMenu"></button>
        </div>
      </header>

      <div class="welcome-screen" id="welcomeScreen">
        <a href="https://liberdus.com" target="_blank" title="Visit Liberdus website" class="logo-link">
          <img src="./media/liberdus_logo_250.png" alt="Liberdus Logo" style="margin-bottom: 20px" />
        </a>
        <h1>
          Liberdus<br />
          <div style="font-size: 0.8rem; margin-top: 1px; text-align: center" id="networkNameDisplay"></div>
        </h1>
        <div class="welcome-buttons">
          <button id="signInButton" class="secondary-button hidden">Sign In</button>
          <button id="createAccountButton" class="secondary-button hidden">Create Account</button>
          <button id="importAccountButton" class="secondary-button hidden">Restore Account</button>
          <!-- <button id="addToHomeScreenButton" class="secondary-button hidden">Install</button> -->
        </div>
        <div style="font-size: 0.8rem; margin-top: 10px; text-align: center">
          Version <span id="versionDisplay"></span>
        </div>
        <!-- Add a unused anchor tag with nothing in it and add a class to it so can't shift and end up on another modal. Should still be displayed but will just show nothing -->
        <a class="last-item" href="#" id="welcomeScreenLastItem"> </a>
      </div>

      <div class="app-screen" id="chatsScreen">
        <!-- search bar -->
        <div class="search-bar-container" id="searchBarContainer">
          <div class="search-bar">
            <span class="search-icon"></span>
            <input
              type="text"
              id="searchInput"
              class="search-input"
              placeholder="Search messages..."
              autocomplete="off"
              readonly
            />
          </div>
        </div>
        <ul class="chat-list" id="chatList">
          <!-- Chat items will be inserted here -->
        </ul>
      </div>

      <div class="app-screen" id="contactsScreen">
        <!-- Add search bar for contacts -->
        <div class="search-bar-container" id="contactSearchBarContainer">
          <div class="search-bar">
            <span class="search-icon"></span>
            <input
              type="text"
              id="contactSearchInput"
              class="search-input"
              placeholder="Search contacts..."
              autocomplete="off"
              readonly
            />
          </div>
        </div>
        <ul class="chat-list" id="contactsList">
          <!-- Contact items will be inserted here -->
        </ul>
      </div>
      <button class="floating-button" id="newChatButton">+</button>

      <div class="app-screen" id="walletScreen">
        <div class="wallet-balance">
          <div class="balance-label">Total Balance</div>
          <div class="balance-amount">
            <span id="walletTotalBalance">0.00</span>
            <button class="refresh-button" id="refreshBalance">â†»</button>
          </div>
        </div>
        <div class="wallet-actions">
          <button class="wallet-action-button" id="openSendAssetFormModal">
            <span class="action-icon"></span>
            <span class="action-label">Send</span>
          </button>
          <button class="wallet-action-button" id="openReceiveModal">
            <span class="action-icon"></span>
            <span class="action-label">Receive</span>
          </button>
          <button class="wallet-action-button" id="openHistoryModal">
            <span class="action-icon"></span>
            <span class="action-label">History</span>
          </button>
        </div>
        <div class="wallet-assets">
          <div class="section-title">Assets</div>
          <div id="assetsList"></div>
        </div>
      </div>

      <footer class="footer" id="footer">
        <div class="nav-buttons">
          <button class="nav-button" id="switchToChats">Chats</button>
          <button class="nav-button" id="switchToContacts">Contacts</button>
          <button class="nav-button" id="switchToWallet">Wallet</button>
        </div>
        <!-- set focus on last-item in the footer -->
        <a class="last-item" href="#"> </a>
      </footer>

      <!-- New Chat Modal -->
      <div class="modal" id="newChatModal">
        <div class="modal-header">
          <button class="back-button" id="closeNewChatModal"></button>
          <div class="modal-title">New Chat</div>
        </div>
        <div class="form-container">
          <form id="newChatForm">
            <div class="form-group">
              <label for="recipient"
                >Recipient <span id="chatRecipientError" style="color: #dc3545; display: none"></span
              ></label>
              <input
                type="text"
                id="chatRecipient"
                class="form-control"
                placeholder="Enter username"
                required
                pattern="[a-zA-Z0-9]*"
                inputmode="text"
              />
            </div>
            <button type="submit" class="update-button">Continue</button>
          </form>
          <a class="last-item" href="#"> </a>
        </div>
      </div>

      <!-- Menu Modal -->
      <div class="modal" id="menuModal">
        <div class="modal-header">
          <button class="back-button" id="closeMenu"></button>
          <div class="modal-title">Menu</div>
        </div>
        <ul class="menu-list">
          <li class="menu-item" id="openAccountForm" data-icon="user">Profile</li>
          <li class="menu-item" id="openToll" data-icon="dollar-sign">Toll</li>
          <li class="menu-item" id="openExportForm" data-icon="download">Backup</li>
          <li class="menu-item" id="openValidator" data-icon="shield">Validator</li>
          <li class="menu-item" id="openInvite" data-icon="mail">Invite</li>
          <!--                <li class="menu-item" id="openSettings">Settings</li> -->
          <li class="menu-item" id="openExplorer" data-icon="search">Explorer</li>
          <li class="menu-item" id="openMonitor" data-icon="globe">Network</li>
          <!--<li class="menu-item" id="openImportFormMenu">Import</li>-->
          <li class="menu-item" id="openRemoveAccount" data-icon="trash-2">Remove</li>
          <li class="menu-item" id="openContact" data-icon="phone">Contact Us</li>
          <li class="menu-item" id="openAbout" data-icon="info">About</li>
          <li class="menu-item" id="handleSignOut" data-icon="log-out">Sign Out</li>
        </ul>
        <a class="last-item" href="#"> </a>
      </div>

      <!-- Contact Modal -->
      <div class="modal" id="contactModal">
        <div class="modal-header">
          <button class="back-button" id="closeContactModal"></button>
          <div class="modal-title">Contact Us</div>
        </div>
        <div class="form-container">
          <div style="padding: 1rem">
            <p>Please contact our team to report bugs or make suggestions.</p>
            <button id="submitFeedback" class="update-button" style="margin-top: 1rem">Submit Feedback</button>
          </div>
          <a class="last-item" href="#"> </a>
        </div>
      </div>

      <!-- About Modal -->
      <div class="modal" id="aboutModal">
        <div class="modal-header">
          <button class="back-button" id="closeAboutModal"></button>
          <div class="modal-title">About Liberdus</div>
        </div>
        <div class="form-container">
          <div class="about-content">
            <img class="about-logo" src="./media/liberdus_logo_250.png" alt="Liberdus Logo" />
            <p class="about-description">Liberdus is a decentralized messaging and wallet application.</p>

            <div class="about-info-section">
              <div class="about-info-item">Version <span id="versionDisplayAbout"></span></div>
              <div class="about-info-item">Network Name: <span id="networkNameAbout"></span></div>
              <div class="about-info-item">
                Net ID:<br />
                <span class="about-net-id" id="netIdAbout"></span>
              </div>
            </div>

            <div class="about-links-section">
              <a class="about-link" href="https://liberdus.com" target="_blank">Liberdus.com</a>
              <a class="about-link" href="https://github.com/liberdus" target="_blank">Source Code</a>
            </div>

            <div class="about-source-links">
              <a class="about-link" href="index.html.txt" target="_blank">index.html</a>
              <a class="about-link" href="styles.css" target="_blank">styles.css</a>
              <a class="about-link" href="app.js" target="_blank">app.js</a>
              <a class="about-link" href="crypto.js" target="_blank">crypto.js</a>
              <a class="about-link" href="lib.js" target="_blank">lib.js</a>
              <a class="about-link" href="network.js" target="_blank">network.js</a>
            </div>

            <div class="about-external-links">
              <a class="about-link" href="./external/noble-post-quantum.js" target="_blank">noble-post-quantum.js</a>
              <a class="about-link" href="./external/noble-secp256k1.js" target="_blank">noble-secp256k1.js</a>
              <a class="about-link" href="./external/noble-ciphers.js" target="_blank">noble-ciphers.js</a>
              <a class="about-link" href="./external/blake2b.js" target="_blank">blake2b.js</a>
              <a class="about-link" href="./external/keccak256.js" target="_blank">keccak256.js</a>
              <a class="about-link" href="./external/stringify-shardus.js" target="_blank">stringify-shardus.js</a>
              <a class="about-link" href="./external/qr.js" target="_blank">qr.js</a>
            </div>
          </div>
        </div>
        <a class="last-item" href="#"> </a>
      </div>

      <!-- Sign In Modal -->
      <div class="modal" id="signInModal">
        <div class="modal-header">
          <button class="back-button" id="closeSignInModal"></button>
          <div class="modal-title">Sign In</div>
        </div>
        <div class="form-container">
          <form id="signInForm">
            <div class="form-group">
              <label for="username"
                >Select Account
                <span id="usernameNotFound" style="color: #dc3545; display: none; display: inline"></span
              ></label>
              <select id="username" class="form-control" required></select>
            </div>
            <button type="submit" class="update-button" disabled>Sign In</button>
            <button type="button" id="removeAccountButton" class="secondary-button" style="display: none">
              Remove
            </button>
          </form>
          <a class="last-item" href="#" id="signInModalLastItem"> </a>
        </div>
      </div>

      <!-- Create Account Modal -->
      <div class="modal" id="createAccountModal">
        <div class="modal-header">
          <button class="back-button" id="closeCreateAccountModal"></button>
          <div class="modal-title">Create Account</div>
        </div>
        <div class="form-container">
          <form id="createAccountForm">
            <div class="form-group">
              <label for="newUsername">
                Username
                <span id="newUsernameAvailable" style="color: #28a745; display: none"> available </span>
              </label>
              <div style="position: relative">
                <input
                  type="text"
                  id="newUsername"
                  class="form-control"
                  placeholder="Select a username"
                  required
                  pattern="[a-zA-Z0-9]*"
                  inputmode="text"
                  maxlength="20"
                />
              </div>
            </div>
            <div class="form-group">
              <input type="checkbox" id="togglePrivateKeyInput" />
              <label for="togglePrivateKeyInput" style="display: inline; margin-left: 5px"
                >Use my own private key (Advanced)</label
              >
            </div>
            <div id="privateKeySection" style="display: none">
              <div class="form-group">
                <label for="newPrivateKey"
                  >Private Key <span id="newPrivateKeyError" style="color: #dc3545; display: none"></span
                ></label>
                <div style="position: relative">
                  <input
                    type="password"
                    id="newPrivateKey"
                    class="form-control"
                    placeholder="Optional private key in hex format"
                  />
                  <button type="button" id="togglePrivateKeyVisibility" class="password-toggle-btn"></button>
                </div>
                <small>
                  If you want to use an existing private key enter it here. Otherwise you can leave this empty to have a
                  private key automatically generated.
                </small>
              </div>
            </div>
            <button type="submit" class="update-button" disabled>Create Account</button>
          </form>
          <a class="last-item" href="#"> </a>
        </div>
      </div>

      <!-- Account Form Modal -->
      <div class="modal fixed-header" id="accountModal">
        <div class="modal-header">
          <button class="back-button" id="closeAccountForm"></button>
          <div class="modal-title">My Profile</div>
        </div>
        <div class="form-container">
          <div class="profile-sharing-note">This information is shared with your friends</div>
          <form id="accountForm">
            <div class="form-group">
              <label for="name">Name</label>
              <input type="text" id="name" class="form-control" required />
            </div>
            <div class="form-group">
              <label for="email">Email</label>
              <input type="email" id="email" class="form-control" />
            </div>
            <div class="form-group">
              <label for="phone">Phone</label>
              <input type="tel" id="phone" class="form-control" />
            </div>
            <div class="form-group">
              <label for="linkedin">LinkedIn</label>
              <input type="text" id="linkedin" class="form-control" />
            </div>
            <div class="form-group">
              <label for="x">X-Twitter</label>
              <input type="text" id="x" class="form-control" />
            </div>
            <button type="submit" class="update-button">Update Profile</button>
          </form>
          <a class="last-item" href="#"> </a>
        </div>
      </div>

      <!-- Import Modal -->
      <div class="modal" id="importModal">
        <div class="modal-header">
          <button class="back-button" id="closeImportForm"></button>
          <div class="modal-title">Restore Account</div>
        </div>
        <div class="form-container">
          <form id="importForm">
            <div class="form-group">
              <label for="importFile">Select File</label>
              <input type="file" id="importFile" class="form-control" accept="application/json" required />
            </div>
            <div class="form-group">
              <label for="importPassword">Password (if encrypted)</label>
              <input
                type="password"
                id="importPassword"
                class="form-control"
                placeholder="Enter password for encrypted files"
              />
            </div>
            <button type="submit" class="update-button">Load Account</button>
          </form>
          <a class="last-item" href="#"> </a>
        </div>
      </div>

      <!-- Chat Modal -->
      <div class="modal fixed-header" id="chatModal">
        <div class="modal-header">
          <button class="back-button" id="closeChatModal"></button>
          <div class="chat-user-info">
            <div class="modal-avatar"></div>
            <div class="modal-title"></div>
          </div>
          <!-- Add header actions container for the edit button and send money button -->
          <div class="header-actions">
            <button class="icon-button edit-icon" id="chatEditButton" aria-label="Edit contact"></button>
            <button class="icon-button send-money-icon" id="chatSendMoneyButton" aria-label="Send money"></button>
            <button class="icon-button add-friend-icon" id="addFriendButtonChat" aria-label="Add friend"></button>
          </div>
        </div>
        <div class="messages-container">
          <div class="messages-list"></div>
        </div>
        <div class="message-input-container">
          <div class="message-byte-counter"></div>
          <div class="message-input-row">
            <div class="message-input-wrapper">
              <textarea class="message-input" placeholder="Type a message..."></textarea>
              <div class="toll-container">
                <span class="toll-label">Toll:</span>
                <span class="toll-value" id="tollValue"></span>
              </div>
            </div>
            <input type="hidden" id="retryOfTxId" />
            <button class="send-button" id="handleSendMessage">
              <svg viewBox="0 0 24 24">
                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" />
              </svg>
            </button>
          </div>
        </div>
        <a class="last-item" href="#"> </a>
      </div>

      <!-- Contact Info Modal -->
      <div class="modal fixed-header" id="contactInfoModal">
        <div class="modal-header">
          <button class="back-button" id="closeContactInfoModal"></button>
          <div class="modal-title">Contact Info</div>
          <!-- Add header actions container -->
          <div class="header-actions">
            <button class="icon-button chat-icon" id="contactInfoChatButton" aria-label="Open chat"></button>
            <button class="icon-button send-money-icon" id="contactInfoSendButton" aria-label="Send money"></button>
            <button
              class="icon-button add-friend-icon"
              id="addFriendButtonContactInfo"
              aria-label="Add friend"
            ></button>
          </div>
        </div>
        <div class="form-container">
          <div class="contact-info-list">
            <div class="contact-avatar-section">
              <div class="avatar" id="contactInfoAvatar"></div>
              <div class="name"></div>
              <div class="subtitle"></div>
            </div>
            <!-- Template for contact info items -->
            <template id="contactInfoItemTemplate">
              <div class="contact-info-item">
                <div class="contact-info-label"></div>
                <div class="contact-info-value"></div>
              </div>
            </template>
            <!-- Contact info fields -->
            <div class="contact-info-item" style="display: none">
              <div class="contact-info-label">Username</div>
              <div class="contact-info-value" id="contactInfoUsername"></div>
            </div>
            <div class="contact-info-item">
              <div class="contact-info-label">Name</div>
              <div class="contact-info-value-container">
                <div class="contact-info-value" id="contactInfoName"></div>
                <button class="icon-button edit-icon" id="nameEditButton" aria-label="Edit name"></button>
              </div>
            </div>
            <div class="contact-info-item" style="display: none">
              <div class="contact-info-label">Provided Name</div>
              <div class="contact-info-value" id="contactInfoProvidedName"></div>
            </div>
            <div class="contact-info-item" style="display: none">
              <div class="contact-info-label">Email</div>
              <div class="contact-info-value">
                <a href="#" id="contactInfoEmail" class="contact-info-link" target="_blank" rel="noopener noreferrer"></a>
              </div>
            </div>
            <div class="contact-info-item" style="display: none">
              <div class="contact-info-label">Phone</div>
              <div class="contact-info-value" id="contactInfoPhone"></div>
            </div>
            <div class="contact-info-item" style="display: none">
              <div class="contact-info-label">LinkedIn</div>
              <div class="contact-info-value">
                <a href="#" id="contactInfoLinkedin" class="contact-info-link" target="_blank" rel="noopener noreferrer"></a>
              </div>
            </div>
            <div class="contact-info-item" style="display: none">
              <div class="contact-info-label">X-Twitter</div>
              <div class="contact-info-value">
                <a href="#" id="contactInfoX" class="contact-info-link" target="_blank" rel="noopener noreferrer"></a>
              </div>
            </div>
          </div>
        </div>
        <a class="last-item" href="#"> </a>
      </div>

      <!-- Friend Modal -->
      <div class="modal" id="friendModal">
        <div class="modal-header">
          <button class="back-button" id="closeFriendModal"></button>
          <div class="modal-title">Friend Status</div>
        </div>
        <div class="modal-content">
          <form id="friendForm">
            <div class="radio-group">
              <label class="radio-option status-3">
                <input type="radio" name="friendStatus" value="3" checked />
                <div class="radio-content">
                  <span class="radio-label">Friend</span>
                  <span class="radio-description">Share my profile info and no toll required</span>
                </div>
              </label>
              <label class="radio-option status-2">
                <input type="radio" name="friendStatus" value="2" />
                <div class="radio-content">
                  <span class="radio-label">Connection</span>
                  <span class="radio-description">No toll required</span>
                </div>
              </label>
              <label class="radio-option status-1">
                <input type="radio" name="friendStatus" value="1" />
                <div class="radio-content">
                  <span class="radio-label">Tolled</span>
                  <span class="radio-description">Toll required to send me messages</span>
                </div>
              </label>
              <label class="radio-option status-0">
                <input type="radio" name="friendStatus" value="0" />
                <div class="radio-content">
                  <span class="radio-label">Blocked</span>
                  <span class="radio-description">Cannot send me messages</span>
                </div>
              </label>
            </div>
            <button type="submit" class="update-button">Update</button>
          </form>
          <a class="last-item" href="#"></a>
        </div>
      </div>

      <!-- Receive Modal -->
      <div class="modal fixed-header" id="receiveModal">
        <div class="modal-header">
          <button class="back-button" id="closeReceiveModal"></button>
          <div class="modal-title">Receive</div>
        </div>
        <div class="form-container">
          <div class="form-group">
            <label>Your Address</label>
            <div style="display: flex; align-items: flex-start; gap: 0.5rem">
              <div
                id="displayAddress"
                class="form-control"
                style="
                  flex: 1;
                  font-size: 0.875rem;
                  padding: 8px 12px;
                  word-break: break-all;
                  line-height: 1.4;
                  background-color: #f8f9fa;
                  cursor: default;
                "
              ></div>
              <button
                id="copyAddress"
                class="icon-button"
                style="color: #007bff; margin-top: 4px; flex-shrink: 0"
              ></button>
            </div>
            <div id="qrcode" style="margin-top: 1rem; display: flex; justify-content: center"></div>

            <!-- QR Code Preview (Moved here) -->
            <div id="qrDataPreview" class="form-control qr-data-preview" style="display: none">
              <!-- Error messages will be placed here directly by JS -->
            </div>
          </div>

          <!-- Payment Request Options (New) -->
          <div class="form-group">
            <label for="receiveAsset">Asset</label>
            <select id="receiveAsset" class="form-control">
              <!-- Will be populated with assets in JavaScript -->
            </select>
          </div>
          <div class="form-group">
            <label for="receiveAmount">Amount (Optional)</label>
            <input
              type="text"
              id="receiveAmount"
              class="form-control"
              placeholder="Enter amount"
              step="any"
              min="0"
            />
          </div>
          <div class="form-group">
            <label for="receiveMemo">Memo (Optional)</label>
            <textarea
              id="receiveMemo"
              class="form-control"
              placeholder="Add a note for the payment"
              maxlength="300"
            ></textarea>
          </div>
        </div>
        <a class="last-item" href="#"> </a>
      </div>

      <!-- History Modal -->
      <div class="modal fixed-header" id="historyModal">
        <div class="modal-header">
          <button class="back-button" id="closeHistoryModal"></button>
          <div class="modal-title">Transaction History</div>
        </div>
        <div class="form-container">
          <div class="form-group">
            <label for="historyAsset">Asset</label>
            <select id="historyAsset" class="form-control"></select>
          </div>
          <div class="transaction-list" id="transactionList">
            <!-- Transactions will be populated here -->
          </div>
        </div>
        <a class="last-item" href="#"> </a>
      </div>

      <!-- Send Asset Form Modal -->
      <div class="modal fixed-header" id="sendAssetFormModal">
        <div class="modal-header">
          <button class="back-button" id="closeSendAssetFormModal"></button>
          <div class="modal-title">Send</div>
        </div>
        <div class="form-container">
          <form id="sendForm">
            <div class="form-group">
              <label for="sendAsset">Asset</label>
              <select id="sendAsset" class="form-control" required></select>
            </div>
            <div class="form-group">
              <label for="sendToAddress"
                >Recipient <span id="sendToAddressError" style="color: #dc3545; display: none"></span
              ></label>
              <div style="display: flex; align-items: center; gap: 0.5rem">
                <input
                  type="text"
                  id="sendToAddress"
                  class="form-control"
                  placeholder="Enter username"
                  required
                  pattern="[a-zA-Z0-9]*"
                  inputmode="text"
                  style="flex: 1"
                />
                <button
                  type="button"
                  id="uploadQRButton"
                  class="icon-button"
                  title="Upload QR Code"
                  style="flex-shrink: 0"
                >
                  <svg viewBox="0 0 24 24" width="24" height="24" style="fill: #007bff">
                    <path
                      d="M19 7v2.99s-1.99.01-2 0V7h-3s.01-1.99 0-2h3V2h2v3h3v2h-3zm-3 4V8h-3V5H5c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-8h-3zM5 19l3-4 2 3 3-4 4 5H5z"
                    />
                  </svg>
                </button>
                <button type="button" id="scanQRButton" class="icon-button" title="Scan QR Code" style="flex-shrink: 0">
                  <svg viewBox="0 0 24 24" width="24" height="24" style="fill: #007bff">
                    <path
                      d="M3,3 L10,3 L10,10 L3,10 Z M5,5 L5,8 L8,8 L8,5 Z M14,3 L21,3 L21,10 L14,10 Z M16,5 L16,8 L19,8 L19,5 Z M3,14 L10,14 L10,21 L3,21 Z M5,16 L5,19 L8,19 L8,16 Z M14,14 L21,14 L21,21 L14,21 Z M16,16 L16,19 L19,19 L19,16 Z M11,3 L13,3 L13,10 L11,10 Z M11,14 L13,14 L13,21 L11,21 Z M3,11 L10,11 L10,13 L3,13 Z M14,11 L21,11 L21,13 L14,13 Z"
                    />
                  </svg>
                </button>
                <!-- File input for QR code upload -->
                <input
                  type="file"
                  id="qrFileInput"
                  accept="image/*"
                  style="display: none; position: absolute; width: 1px; height: 1px; overflow: hidden"
                  aria-hidden="true"
                />
              </div>
            </div>
            <div class="form-group">
              <label for="sendAmount">Amount</label>
              <div class="amount-container">
                <input
                  type="text"
                  id="sendAmount"
                  class="form-control"
                  required
                />
                <!-- add button to toggle between LIB and USD -->
                <button id="toggleBalance" class="toggle-balance">
                  <span id="balanceSymbol">LIB</span>
                </button>
              </div>
              <div id="balanceWarning" class="balance-warning"></div>
              <div id="availableBalance" class="available-balance">
                <div class="balance-info">
                  <span>Available: <span id="balanceAmount">0.00 LIB</span></span>
                  <span class="fee-info">Fee: <span id="transactionFee">0.00 LIB</span></span>
                </div>
              </div>
            </div>
            <div class="form-group">
              <label for="sendMemo">
                Memo (Optional)
                <span class="memo-byte-counter" style="font-size: 12px; margin-left: 8px; font-weight: normal; display: none;"></span>
              </label>
              <textarea id="sendMemo" class="form-control"></textarea>
              <div class="toll-container" id="memoTollContainer">
                <span class="toll-memo" id="tollMemo"></span>
              </div>
            </div>
            <input type="hidden" id="retryOfPaymentTxId" />
            <button type="submit" class="update-button">Send</button>
          </form>

          <!-- QR Scan Container -->
          <div id="qrScannerContainer" class="qr-scanner-container" style="display: none">
            <video id="qrVideo" playsinline autoplay></video>
            <div class="scanner-overlay">
              <div class="scanner-guide"></div>
            </div>
            <div class="scanner-controls">
              <button id="closeScanner" class="scanner-button">Cancel</button>
              <button id="switchCamera" class="scanner-button">Switch Camera</button>
            </div>
          </div>
        </div>
        <a class="last-item" href="#"> </a>
      </div>

      <!-- Send Asset Confirmation Modal -->
      <div class="modal fixed-header" id="sendAssetConfirmModal">
        <div class="modal-header">
          <button class="back-button" id="closeSendAssetConfirmModal"></button>
          <div class="modal-title">Confirm Transaction</div>
        </div>
        <div class="form-container">
          <div class="confirmation-details">
            <div class="form-group">
              <label>Recipient</label>
              <div id="confirmRecipient" class="confirm-value"></div>
            </div>
            <div class="form-group">
              <label>Amount</label>
              <div id="confirmAmount" class="confirm-value"></div>
              <div id="confirmAmountUSD" class="confirm-value-secondary usd-equivalent"></div>
            </div>
            <div class="form-group">
              <label>Asset</label>
              <div id="confirmAsset" class="confirm-value"></div>
            </div>
            <div class="form-group" id="confirmMemoGroup" style="display: none">
              <label>Memo</label>
              <div id="confirmMemo" class="confirm-value"></div>
            </div>
          </div>
          <button id="confirmSendButton" class="update-button">Confirm Send</button>
          <button id="cancelSendButton" class="secondary-button">Cancel</button>
        </div>
        <a class="last-item" href="#"> </a>
      </div>

      <!-- Export Modal -->
      <div class="modal" id="exportModal">
        <div class="modal-header">
          <button class="back-button" id="closeExportForm"></button>
          <div class="modal-title">Backup Account</div>
        </div>
        <div class="form-container">
          <form id="exportForm">
            <div class="form-group">
              <label for="exportPassword">Password</label>
              <input
                type="password"
                id="exportPassword"
                class="form-control"
                placeholder="Leave empty for unencrypted export"
              />
            </div>
            <button type="submit" class="update-button">Download Data</button>
          </form>
          <a class="last-item" href="#"> </a>
        </div>
      </div>

      <!-- Remove Account Modal -->
      <div class="modal" id="removeAccountModal">
        <div class="modal-header">
          <button class="back-button" id="closeRemoveAccountModal"></button>
          <div class="modal-title">Remove Account</div>
        </div>
        <div class="form-container">
          <div style="padding: 1rem">
            <p>
              Before removing your account, please export your account data to ensure you have a backup. This action
              only removes the account from this device and not from the network. You can use the account again after
              restoring it from the backup file.
            </p>
            <button id="confirmRemoveAccount" class="update-button" style="margin-top: 1rem">Remove</button>
          </div>
          <a class="last-item" href="#"> </a>
        </div>
      </div>

      <!-- Add search modal before the other modals -->
      <div class="modal search-modal" id="searchModal">
        <div class="modal-header">
          <button class="back-button" id="closeSearchModal"></button>
          <div class="modal-title">Search Messages</div>
        </div>
        <div class="form-container">
          <div class="search-bar">
            <span class="search-icon"></span>
            <input
              type="text"
              id="messageSearch"
              class="search-input"
              placeholder="Search messages..."
              autocomplete="off"
              autofocus
              maxlength="30"
            />
          </div>
          <div id="searchResults" class="chat-list">
            <!-- Results will be populated here -->
          </div>
          <a class="last-item" href="#"> </a>
        </div>
      </div>

      <!-- Add new contact search modal before closing body tag -->
      <div class="modal search-modal" id="contactSearchModal">
        <div class="modal-header">
          <button class="back-button" id="closeContactSearchModal"></button>
          <div class="modal-title">Search Contacts</div>
        </div>
        <div class="form-container">
          <div class="search-bar">
            <span class="search-icon"></span>
            <input
              type="text"
              id="contactSearch"
              class="search-input"
              placeholder="Search contacts..."
              autocomplete="off"
              autofocus
              maxlength="30"
            />
          </div>
          <div id="contactSearchResults" class="chat-list">
            <!-- Contact search results will be populated here -->
          </div>
          <a class="last-item" href="#"> </a>
        </div>
      </div>

      <!-- Edit Contact Modal -->
      <div class="modal fixed-header" id="editContactModal">
        <div class="modal-header">
          <button class="back-button" id="closeEditContactModal"></button>
          <div class="modal-title">Edit Contact</div>
        </div>
        <div class="form-container">
          <div class="contact-info-list">
            <div class="contact-avatar-section">
              <div class="avatar"></div>
              <div class="name"></div>
              <div class="subtitle"></div>
            </div>
            <div class="contact-info-item" style="display: none">
              <div class="contact-info-label">Username</div>
              <div class="contact-info-value" id="editContactUsername"></div>
            </div>
            <div class="contact-info-item">
              <div class="contact-info-label">Name</div>
              <div class="contact-info-value-container">
                <div class="contact-info-value editing">
                  <input
                    type="text"
                    class="edit-field-input"
                    id="editContactNameInput"
                    placeholder="Enter contact name"
                  />
                  <button class="field-action-button clear" aria-label="Add"></button>
                </div>
              </div>
            </div>
            <div class="contact-info-item" id="editContactProvidedNameContainer" style="display: none">
              <div class="contact-info-label">Provided Name</div>
              <div class="contact-info-value" id="editContactProvidedName"></div>
            </div>
            <div class="contact-info-item" style="display: none">
              <div class="contact-info-label">Email</div>
              <div class="contact-info-value" id="editContactEmail"></div>
            </div>
            <div class="contact-info-item" style="display: none">
              <div class="contact-info-label">Phone</div>
              <div class="contact-info-value" id="editContactPhone"></div>
            </div>
            <div class="contact-info-item" style="display: none">
              <div class="contact-info-label">LinkedIn</div>
              <div class="contact-info-value" id="editContactLinkedin"></div>
            </div>
            <div class="contact-info-item" style="display: none">
              <div class="contact-info-label">X-Twitter</div>
              <div class="contact-info-value" id="editContactX"></div>
            </div>
          </div>
          <a class="last-item" href="#"> </a>
        </div>
      </div>

      <!-- Validator Modal -->
      <div class="modal fixed-header" id="validatorModal">
        <div class="modal-header">
          <button class="back-button" id="closeValidatorModal"></button>
          <div class="modal-title">Validator Staking</div>
        </div>
        <div class="modal-content">
          <!-- Loading State -->
          <div id="validator-loading" style="text-align: center; padding: 1rem; display: none">
            <div class="spinner"></div>
            <!-- Add spinner styles if needed -->
            Loading validator details...
          </div>

          <!-- Error Message Area -->
          <div
            id="validator-error-message"
            class="error-message"
            style="display: none; padding: 1rem; color: #dc3545; text-align: center"
          >
            <!-- Error text will be populated here -->
          </div>

          <!-- Validator Details Display Area -->
          <div id="validator-details" class="validator-info-container" style="display: block">
            <div class="info-section">
              <h4>Your Stake Info</h4>
              <!-- New Skeleton Bars for Pending Nominee Info -->
              <div
                class="skeleton-item"
                id="pending-nominee-skeleton-1"
                style="
                  display: none;
                  height: 22px;
                  width: 100%;
                  margin-top: 4px;
                  margin-bottom: 8px;
                  background-color: #e0e0e0;
                  padding: 0 5px;
                  box-sizing: border-box;
                "
              >
                <span
                  id="pending-tx-text-in-bar"
                  style="
                    display: none;
                    font-size: 0.75em;
                    color: #333;
                    line-height: 22px;
                    width: 100%;
                    text-align: center;
                  "
                ></span>
              </div>
              <div class="info-item vertical-layout">
                <span class="info-label" id="validator-nominee-label">Nominated Validator:</span>
                <span class="info-value code" id="validator-nominee"></span>
              </div>
              <div class="info-item" id="validator-user-stake-lib-item">
                <span class="info-label">Staked Amount (LIB):</span>
                <span class="info-value" id="validator-user-stake-lib"></span>
              </div>
              <div class="info-item" id="validator-user-stake-usd-item">
                <span class="info-label">Staked Amount (USD):</span>
                <span class="info-value" id="validator-user-stake-usd"></span>
              </div>
            </div>

            <div class="info-section">
              <h4>Network Staking Info</h4>
              <div class="info-item">
                <span class="info-label">Min Stake Required (USD):</span>
                <span class="info-value" id="validator-network-stake-usd"></span>
              </div>
              <div class="info-item">
                <span class="info-label">Min Stake Required (LIB):</span>
                <span class="info-value" id="validator-network-stake-lib"></span>
              </div>
              <div class="info-item">
                <span class="info-label">Stability Factor (USD/LIB):</span>
                <span class="info-value" id="validator-stability-factor"></span>
              </div>
              <div class="info-item" style="display: none">
                <span class="info-label">Market Price (USD/LIB):</span>
                <span class="info-value" id="validator-market-price"></span>
              </div>
              <div class="info-item" style="display: none">
                <span class="info-label">Min Stake at Market (USD):</span>
                <span class="info-value" id="validator-market-stake-usd"></span>
              </div>
            </div>
          </div>

          <div class="action-item">
            <button id="openStakeModal" class="button full-width">Stake</button>
            <p class="action-description">Delegate LIB to a validator node to earn rewards.</p>
          </div>

          <div class="action-item">
            <button id="submitUnstake" class="button full-width secondary-button">Unstake</button>
            <p class="action-description">Withdraw your delegated LIB from a validator node.</p>
          </div>
        </div>
        <a class="last-item" href="#"> </a>
      </div>

      <!-- Toll Modal -->
      <div class="modal" id="tollModal">
        <div class="modal-header">
          <button class="back-button" id="closeTollModal"></button>
          <div class="modal-title">Toll Settings</div>
        </div>
        <div class="form-container">
          <!-- Current Toll Amount Display Area - Moved outside the form -->
          <div class="toll-display-area">
            <label for="currentTollValue">Current Toll Amount</label>
            <div class="form-text help-text">
              This is the toll amount a sender must pay to send a message or payment to you.
            </div>
            <div id="tollAmountLIB" class="current-toll-value-box">
              <span id="tollAmountLIB">N/A LIB</span>
            </div>
            <div id="tollAmountUSD" class="current-toll-value-box">
              <span id="tollAmountUSD">N/A USD</span>
            </div>
          </div>

          <form id="tollForm">
            <div class="form-group">
              <label for="newTollAmountInput">Set New Toll Amount</label>
              <div class="form-text help-text">
                Sets a new toll amount a sender must pay to send a message or payment to you. All tolls are received in
                LIB. If you enter a USD amount, you will receive the equivalent LIB value at market price. Aside from 0
                (no toll), there is a minimum toll as shown below.
              </div>
              <div class="amount-container">
                <input
                  type="text"
                  id="newTollAmountInput"
                  class="form-control"
                  placeholder="Enter new amount"
                  required
                />
                <button type="button" id="toggleTollCurrency" class="toggle-balance">
                  <span id="tollCurrencySymbol">LIB</span>
                </button>
              </div>
              <div id="minTollDisplay" class="form-text help-text">Minimum toll: Loading...</div>
              <div id="tollWarningMessage" class="form-text warning-text" style="display: none"></div>
            </div>
            <button type="submit" id="saveNewTollButton" class="update-button">Save Changes</button>
          </form>
        </div>
        <a class="last-item" href="#"> </a>
      </div>

      <!-- Stake Modal -->
      <div class="modal fixed-header" id="stakeModal">
        <div class="modal-header">
          <button class="back-button" id="closeStakeModal"></button>
          <div class="modal-title">Stake Validator</div>
        </div>
        <div class="form-container">
          <form id="stakeForm">
            <div class="form-group" id="stakeNodeAddressGroup">
              <label for="stakeNodeAddress">Validator Node Address</label>
              <div style="display: flex; align-items: center; gap: 0.5rem">
                <input
                  type="text"
                  id="stakeNodeAddress"
                  class="form-control"
                  required
                  placeholder="Enter long node address"
                  style="flex: 1"
                />
                <button
                  type="button"
                  id="uploadStakeQRButton"
                  class="icon-button"
                  title="Upload Stake Address QR"
                  style="flex-shrink: 0"
                >
                  <svg viewBox="0 0 24 24" width="24" height="24" style="fill: #007bff">
                    <path
                      d="M19 7v2.99s-1.99.01-2 0V7h-3s.01-1.99 0-2h3V2h2v3h3v2h-3zm-3 4V8h-3V5H5c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-8h-3zM5 19l3-4 2 3 3-4 4 5H5z"
                    />
                  </svg>
                </button>
                <button
                  type="button"
                  id="scanStakeQRButton"
                  class="icon-button"
                  title="Scan Stake Address QR"
                  style="flex-shrink: 0"
                >
                  <svg viewBox="0 0 24 24" width="24" height="24" style="fill: #007bff">
                    <path
                      d="M3,3 L10,3 L10,10 L3,10 Z M5,5 L5,8 L8,8 L8,5 Z M14,3 L21,3 L21,10 L14,10 Z M16,5 L16,8 L19,8 L19,5 Z M3,14 L10,14 L10,21 L3,21 Z M5,16 L5,19 L8,19 L8,16 Z M14,14 L21,14 L21,21 L14,21 Z M16,16 L16,19 L19,19 L19,16 Z M11,3 L13,3 L13,10 L11,10 Z M11,14 L13,14 L13,21 L11,21 Z M3,11 L10,11 L10,13 L3,13 Z M14,11 L21,11 L21,13 L14,13 Z"
                    />
                  </svg>
                </button>
                <!-- File input for Stake QR code upload -->
                <input
                  type="file"
                  id="stakeQrFileInput"
                  accept="image/*"
                  style="display: none; position: absolute; width: 1px; height: 1px; overflow: hidden"
                  aria-hidden="true"
                />
              </div>
              <div id="stakeNodeAddressWarning" class="validation-warning" style="display: none"></div>
            </div>
            <div class="form-group">
              <label for="stakeAmount">Stake Amount</label>
              <div id="stakeAvailableBalanceDisplay" class="available-balance-display"></div>
              <input
                type="text"
                id="stakeAmount"
                class="form-control"
                required
                placeholder="Enter amount to stake"
              />
              <div id="stakeAmountWarning" class="validation-warning" style="display: none"></div>
            </div>
            <button type="submit" id="submitStake" class="button full-width">Submit Stake</button>
          </form>
          <a class="last-item" href="#"> </a>
        </div>
      </div>

      <!-- QR Scan Modal -->
      <div class="modal fixed-header" id="qrScanModal">
        <div class="modal-header">
          <button class="back-button" id="closeQRScanModal"></button>
          <div class="modal-title">Scan QR</div>
        </div>
        <div class="scanner-container">
          <p id="scan-waiting" class="status"></p>
          <video id="video"></video>
          <div class="scan-region-highlight"></div>
          <div class="scan-highlight" id="scan-highlight"></div>
          <canvas id="canvas"></canvas>
        </div>
        <a class="last-item" href="#"> </a>
      </div>

      <!-- Failed Message Modal -->
      <div class="modal modal-dialog" id="failedMessageModal">
        <div class="dialog-box-content">
          <div class="modal-header">
            <button class="back-button" id="closeFailedMessageModal"></button>
            <div class="modal-title">Failed Message</div>
          </div>
          <div class="form-container">
            <div class="modal-actions">
              <button type="button" class="secondary-button delete-button">Delete</button>
              <button type="button" class="update-button retry-button">Edit & Resend</button>
            </div>
          </div>
        </div>
        <a class="last-item" href="#"> </a>
      </div>

      <!-- Failed Transaction Modal -->
      <div class="modal modal-dialog" id="failedTransactionModal">
        <div class="dialog-box-content">
          <div class="modal-header">
            <button class="back-button" id="closeFailedTransactionModal"></button>
            <div class="modal-title">Failed Transaction</div>
          </div>
          <div class="form-container">
            <div class="modal-actions">
              <button type="button" class="secondary-button delete-button">Delete</button>
              <button type="button" class="update-button retry-button">Edit & Resend</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Invite Modal -->
      <div class="modal" id="inviteModal">
        <div class="modal-header">
          <button class="back-button" id="closeInviteModal"></button>
          <div class="modal-title">Invite Friends</div>
        </div>
        <div class="form-container">
          <p class="modal-summary">
            Enter an email. An invitation with your account username will be sent to the email address.
          </p>
          <form id="inviteForm">
            <div class="form-group">
              <label for="inviteEmail">Email</label>
              <input type="email" id="inviteEmail" class="form-control" placeholder="Enter email address" />
            </div>
            <div class="form-group" style="display: none">
              <label for="invitePhone">Phone Number</label>
              <input type="tel" id="invitePhone" class="form-control" placeholder="Enter phone number" />
            </div>
            <button type="submit" class="update-button">Send Invitation</button>
          </form>
          <a class="last-item" href="#"></a>
        </div>
      </div>

      <a class="last-item" href="#"> </a>
    </div>
    <!-- Audio element for notification sounds -->
    <audio id="notificationSound" src="media/chatSound.mp3" preload="auto"></audio>
    <audio id="transferSound" src="media/paymentSound.mp3" preload="auto"></audio>
    <!-- Toast container -->
    <div class="toast-container" id="toastContainer"></div>
  </body>
</html>
